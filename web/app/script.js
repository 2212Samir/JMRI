/*
 * Template for the web app script generated by JMRI.
 * 
 * This template will be completed with dependences (item 1), routes (2),
 * navigation menu items (3), and additional providers (4)
 */

// create the jmri.app module
angular.module('jmri.app', [
  // dependencies %1$s
]);

// configure the jmri.app module
angular.module('jmri.app').config(['$routeProvider',
  function ($routeProvider) {
    'use strict';

    $routeProvider
    // routes %2$s
    // Default
    .otherwise({redirectTo: '/'});
  }
]);

// add the navigation menu controller to the jmri.app module
angular.module('jmri.app').controller('NavigationCtrl', ['$scope', '$http', '$jsonSocket', '$log',
  function ($scope, $http, $jsonSocket, $log) {
    // navigation items %3$s

    // about display
    $http.get('/app/about').then(function (response) {
      $scope.additionalInfo = response.data.additionalInfo;
      $scope.copyright = response.data.copyright;
      $scope.imgAlt = response.data.imgAlt;
      $scope.imgSrc = response.data.imgSrc;
      $scope.title = response.data.title;
      $scope.productInfo = response.data.productInfo;
    });
    $scope.openAboutModal = function () {
      $scope.isAboutModalOpen = true;
    };
    $scope.onAboutModalClose = function() {
      $scope.isAboutModalOpen = false;
    };
    
    // power menu
    $jsonSocket.register({
      open: function() {
        socket.getPower();
      },
      power: function (state) {
        $log.info('got power');
        $('#navbar-power').data('power', state);
        disabled = ($('#navbar-power button').hasClass('disabled')) ? " - Setting power disabled" : "";
        switch (state) {
          case JsonSocket.UNKNOWN:
            $('#navbar-power button').addClass('btn-warning').removeClass('btn-success').removeClass('btn-danger');
            $('#navbar-power button').prop('title', "Layout power unknown" + disabled);
            $('#navbar-power a').text("Layout Power Unknown");
            break;
          case JsonSocket.POWER_ON:
            $('#navbar-power button').addClass('btn-success').removeClass('btn-danger').removeClass('btn-warning');
            $('#navbar-power button').prop('title', "Layout power on" + disabled);
            $('#navbar-power a').text("Layout Power On");
            break;
          case JsonSocket.POWER_OFF:
            $('#navbar-power button').addClass('btn-danger').removeClass('btn-success').removeClass('btn-warning');
            $('#navbar-power button').prop('title', "Layout power off" + disabled);
            $('#navbar-power a').text("Layout Power Off");
            break;
        }
      }
    });
    $log.info('Getting power...');
    $jsonSocket.list('power');
    
  }
]);

// additional providers %4$s